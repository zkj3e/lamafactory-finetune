# Alpaca 与 ShareGPT 格式总结（含多模态）

## 一、Alpaca 格式
适用于指令监督微调 (Instruction-Tuning) 的数据格式。

### 字段说明
| 字段 | 类型 | 必填 | 含义 |
|------|------|------|------|
| instruction | string | 是 | 指令或任务描述 |
| input | string | 否 | 补充输入或上下文 |
| output | string | 是 | 模型输出（正确回答） |
| system | string | 否 | 系统提示词 |
| history | array of [string, string] | 否 | 多轮对话历史 |

### 示例
```json
[
  {
    "instruction": "计算这些物品的总费用。",
    "input": "汽车 - $3000，衣服 - $100，书 - $20。",
    "output": "总费用为 $3120。"
  },
  {
    "instruction": "今天的天气怎么样？",
    "input": "",
    "output": "今天的天气不错，是晴天。",
    "history": [
      ["今天会下雨吗？", "今天不会下雨。"],
      ["今天适合出去玩吗？", "非常适合。"]
    ]
  }
]
```

---

## 二、ShareGPT 格式
适用于包含多角色（human、gpt、function_call、observation 等）对话的格式，支持工具调用与偏好训练。

### 字段说明
| 字段 | 类型 | 必填 | 含义 |
|------|------|------|------|
| conversations | array | 是 | 一轮对话的消息序列 |
| from | string | 是 | 角色来源（human/gpt/function_call/observation） |
| value | string | 是 | 消息内容 |
| system | string | 否 | 系统提示词 |
| tools | string / array | 否 | 工具描述 |
| chosen / rejected | object | 否 | 偏好训练中标注优劣答案 |

### 示例（指令监督微调）
```json
[
  {
    "conversations": [
      {"from": "human", "value": "你好，我出生于1990年5月15日。你能告诉我我今天几岁了吗？"},
      {"from": "function_call", "value": "{"name": "calculate_age", "arguments": {"birthdate": "1990-05-15"}}"},
      {"from": "observation", "value": "{"age": 31}"},
      {"from": "gpt", "value": "你今天31岁了。"}
    ],
    "tools": "[{"name": "calculate_age", "description": "根据出生日期计算年龄"}]"
  }
]
```

### 示例（偏好训练）
```json
[
  {
    "conversations": [
      {"from": "human", "value": "老虎会吃草还是树叶？"}
    ],
    "chosen": {
      "from": "gpt",
      "value": "老虎是食肉动物，不吃草或树叶。它们主要吃大型哺乳动物。"
    },
    "rejected": {
      "from": "gpt",
      "value": "老虎可能会选择吃草或树叶。"
    }
  }
]
```

---

## 三、ShareGPT 多模态格式
用于多模态模型（如支持图像输入的 Chat 模型）。可以在单条消息中包含图像、文本等不同类型内容。

### 字段说明
| 字段 | 类型 | 必填 | 含义 |
|------|------|------|------|
| role | string | 是 | 消息角色（user、assistant、system） |
| content | array | 是 | 消息内容，由多个部分组成（文本、图像等） |
| type | string | 是 | 内容类型，如 "text" 或 "image" |
| text | string | 否 | 文本内容 |
| image | string | 否 | 图片路径、URL 或 base64 数据 |
| max_pixels | int | 否 | 限制图像最大像素数（防止内存溢出） |

### 示例（单轮多模态输入）
```json
[
  {
    "role": "user",
    "content": [
      {"type": "image", "image": "/path/to/xray.png"},
      {"type": "text", "text": "请分析这张X光图中是否有肺部阴影"}
    ]
  }
]
```

### 示例（多轮多模态对话）
```json
[
  {
    "role": "user",
    "content": [
      {"type": "image", "image": "https://example.com/dog.jpg"},
      {"type": "text", "text": "这只狗看起来开心吗？"}
    ]
  },
  {
    "role": "assistant",
    "content": [
      {"type": "text", "text": "是的，它看起来非常开心，嘴角上扬且眼神放松。"}
    ]
  },
  {
    "role": "user",
    "content": [
      {"type": "text", "text": "它的毛色是什么？"}
    ]
  },
  {
    "role": "assistant",
    "content": [
      {"type": "text", "text": "这只狗是棕白相间的毛色。"}
    ]
  }
]
```

---

## 四、总结对比

| 项目 | Alpaca 格式 | ShareGPT 格式 | ShareGPT 多模态格式 |
|------|--------------|----------------|----------------------|
| 适用场景 | 单轮指令微调 | 多轮对话、工具调用、偏好训练 | 图像+文本联合输入 |
| 核心字段 | instruction, input, output | conversations, from, value | role, content, type |
| 是否支持历史 | ✅（history） | ✅（天然支持） | ✅ |
| 是否支持工具调用 | ❌ | ✅ | ✅（可扩展） |
| 是否支持偏好训练 | ❌ | ✅ | ✅ |
| 是否支持图像输入 | ❌ | ❌ | ✅ |

---

## 五、总结
- **Alpaca 格式**：结构简单，适合单轮文本任务训练。  
- **ShareGPT 格式**：支持多角色、多轮对话、工具调用和偏好数据。  
- **ShareGPT 多模态格式**：进一步扩展，可在对话中包含图像等多模态输入，适用于视觉语言模型（如 GPT‑4V、Qwen‑VL、GLM‑4V 等）。
